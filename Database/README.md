# Database Documentation

## ğŸ“ Cáº¥u trÃºc thÆ° má»¥c

```
Database/
â”œâ”€â”€ Schema/              # Database schema files
â”‚   â”œâ”€â”€ 01_create_database.sql
â”‚   â””â”€â”€ schema.prisma    # Prisma schema (copy from backend)
â”œâ”€â”€ Seeds/               # Seed data scripts
â”‚   â”œâ”€â”€ 01_seed_users_roles.sql
â”‚   â””â”€â”€ 02_seed_master_data.sql
â”œâ”€â”€ Migrations/          # Migration history (generated by Prisma)
â””â”€â”€ Backup/              # Backup scripts
```

## ğŸ—„ï¸ Database Schema

### Tá»•ng quan
- **Database**: PostgreSQL 14+
- **Tá»•ng sá»‘ báº£ng**: 13+ tables (extensible)
- **Extensions**: uuid-ossp, pg_trgm, btree_gist

### NhÃ³m báº£ng chÃ­nh

#### 1. Authentication & Authorization (5 tables)
- `users` - NgÆ°á»i dÃ¹ng há»‡ thá»‘ng
- `roles` - Vai trÃ²
- `permissions` - Quyá»n háº¡n
- `role_permissions` - Mapping role-permission
- `user_roles` - Mapping user-role

#### 2. Master Data (7 tables)
- `products` - Sáº£n pháº©m
- `product_categories` - Danh má»¥c sáº£n pháº©m
- `uom` - ÄÆ¡n vá»‹ tÃ­nh
- `warehouses` - Kho hÃ ng
- `suppliers` - NhÃ  cung cáº¥p (to be added)
- `customers` - KhÃ¡ch hÃ ng (to be added)
- `carriers` - ÄÆ¡n vá»‹ váº­n chuyá»ƒn (to be added)

#### 3. System
- `audit_logs` - Nháº­t kÃ½ kiá»ƒm toÃ¡n

## ğŸš€ HÆ°á»›ng dáº«n Setup

### 1. Táº¡o Database

```bash
psql -U postgres -f Schema/01_create_database.sql
```

### 2. Cháº¡y Prisma Migrations

```bash
cd ../Source/backend
npx prisma migrate dev --name init
```

### 3. Seed dá»¯ liá»‡u

```bash
# Seed users vÃ  roles
psql -U postgres -d wms_db -f Database/Seeds/01_seed_users_roles.sql

# Seed master data
psql -U postgres -d wms_db -f Database/Seeds/02_seed_master_data.sql
```

## ğŸ‘¤ Default Credentials

Sau khi seed dá»¯ liá»‡u:

```
Email: admin@email.com
Password: Pass@123
```

**âš ï¸ LÆ¯U Ã**: Äá»•i máº­t kháº©u ngay sau láº§n Ä‘Äƒng nháº­p Ä‘áº§u tiÃªn!

## ğŸ“Š Seed Data

### Users & Roles
- **5 Roles**:
  - SUPER_ADMIN (full access)
  - WAREHOUSE_MANAGER
  - WAREHOUSE_STAFF
  - ACCOUNTANT
  - VIEWER

- **25+ Permissions** Ä‘Æ°á»£c phÃ¢n chia theo modules

### Master Data
- **8 Units of Measure**: PCS, BOX, CTN, PLT, KG, G, L, ML
- **5 Product Categories**: Electronics, Food, Clothing, Pharma, Home
- **3 Warehouses**: HCM Main, HN Secondary, HCM Cold Storage
- **3 Sample Products**: Laptops, Mouse, USB Cable

## ğŸ”§ Database Utilities

### Backup Database

```bash
pg_dump -U postgres -d wms_db -F c -f backup_$(date +%Y%m%d).dump
```

### Restore Database

```bash
pg_restore -U postgres -d wms_db -c backup_20250101.dump
```

### Reset Database

```bash
psql -U postgres -f Schema/01_create_database.sql
cd ../Source/backend
npx prisma migrate reset --force
```

## ğŸ“ˆ Performance Optimization

### Recommended Indexes
CÃ¡c indexes quan trá»ng Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong Prisma schema:
- `@@index([email])` trÃªn users
- `@@index([username])` trÃªn users
- `@@index([parent_id])` trÃªn product_categories
- `@@index([path])` trÃªn product_categories
- `@@index([sku])` trÃªn products
- `@@index([category_id])` trÃªn products

### PostgreSQL Configuration
Khuyáº¿n nghá»‹ trong `postgresql.conf`:

```ini
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
work_mem = 4MB
max_connections = 100
```

## ğŸ”’ Security Best Practices

1. **Password Policy**: Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±, bao gá»“m chá»¯ hoa, chá»¯ thÆ°á»ng, sá»‘ vÃ  kÃ½ tá»± Ä‘áº·c biá»‡t
2. **Connection Limits**: Giá»›i háº¡n sá»‘ káº¿t ná»‘i Ä‘á»“ng thá»i
3. **SSL/TLS**: Sá»­ dá»¥ng SSL cho production
4. **Row-Level Security**: CÃ¢n nháº¯c báº­t RLS cho cÃ¡c báº£ng nháº¡y cáº£m
5. **Audit Logging**: Táº¥t cáº£ thao tÃ¡c quan trá»ng Ä‘Æ°á»£c log vÃ o `audit_logs`

## ğŸ“ Migration Strategy

### Development
```bash
npx prisma migrate dev --name <migration_name>
```

### Production
```bash
npx prisma migrate deploy
```

## ğŸ” Troubleshooting

### Lá»—i káº¿t ná»‘i
```bash
# Kiá»ƒm tra PostgreSQL service
sudo systemctl status postgresql

# Restart PostgreSQL
sudo systemctl restart postgresql
```

### Lá»—i permissions
```bash
# Grant permissions
GRANT ALL PRIVILEGES ON DATABASE wms_db TO your_user;
```

### Reset migrations
```bash
# XÃ³a táº¥t cáº£ migrations
rm -rf Source/backend/prisma/migrations

# Táº¡o láº¡i migration má»›i
npx prisma migrate dev --name reinit
```

## ğŸ“š TÃ i liá»‡u tham kháº£o

- [Prisma Documentation](https://www.prisma.io/docs)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Database Design Best Practices](https://www.postgresql.org/docs/current/ddl-best-practices.html)
